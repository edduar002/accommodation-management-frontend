<!-- Sección principal del perfil del usuario -->
<div class="profile-section mt-5">

  <!-- Título de la sección -->
  <h2 class="text-center mb-5 fw-bold">
    Editar información del usuario
  </h2>

  <div class="row justify-content-center">
    <div class="col-md-6">

      <!-- Card contenedor del formulario y datos del usuario -->
      <div class="card shadow-sm border-0 rounded-4 p-4">

        <!-- Imagen de perfil y encabezado -->
        <div class="text-center mb-4">

          <!-- Imagen de perfil dinámica -->
          <img [src]="user.imgUrl" alt="Foto de perfil" class="rounded-circle img-thumbnail shadow-sm mb-3"
            style="width: 120px; height: 120px; object-fit: cover;" />

          <!-- Input para cambiar imagen -->
          <input type="file" accept="image/*" (change)="onFileSelected($event)"
            class="form-control w-75 mx-auto mt-2" />
          <small class="text-muted d-block mt-2">
            Sube una nueva imagen para actualizar tu foto de perfil.
          </small>

          <!-- Nombre y correo del usuario -->
          <h5 class="mt-3 fw-semibold">
            {{ user.name }} {{ user.surname }}
          </h5>
          <p class="text-muted mb-0">{{ user.email }}</p>
        </div>

        <!-- Formulario para editar información del usuario -->
        <div class="card-body">
          <form #profileForm="ngForm" (ngSubmit)="onSubmit(profileForm)">

            <!-- Campo Nombre -->
            <div class="mb-3">
              <label for="name" class="form-label fw-semibold">Nombre</label>
              <input type="text" id="name" class="form-control" name="name" [(ngModel)]="user.name" required />
            </div>

            <!-- Campo Apellido -->
            <div class="mb-3">
              <label for="surname" class="form-label fw-semibold">Apellido</label>
              <input type="text" id="surname" class="form-control" name="surname" [(ngModel)]="user.surname" required />
            </div>

            <!-- Campo Correo Electrónico -->
            <div class="mb-3">
              <label for="email" class="form-label fw-semibold">Correo Electrónico</label>
              <input type="email" id="email" class="form-control" name="email" [(ngModel)]="user.email" required />
            </div>

            <!-- Campo Teléfono -->
            <div class="mb-3">
              <label for="phone" class="form-label fw-semibold">Teléfono</label>
              <input type="tel" id="phone" class="form-control" name="phone" [(ngModel)]="user.phone" />
            </div>

            <!-- Selector Departamento dinámico -->
            <div class="mb-3">
              <label for="department" class="form-label fw-bold">Departamento</label>
              <select class="form-select" id="department" name="department" #department="ngModel"
                [(ngModel)]="user.departmentId" (change)="onDepartmentChange()" required>
                <option value="" disabled selected>Seleccione un departamento</option>
                <option *ngFor="let dep of departamentos" [ngValue]="dep.id">{{ dep.name }}</option>
              </select>
              <!-- Mensaje de error si no se selecciona departamento -->
              <div *ngIf="department.invalid && department.touched" class="text-danger mt-1">
                <small>Seleccione un departamento.</small>
              </div>
            </div>

            <!-- Selector Ciudad dinámico -->
            <div class="mb-3">
              <label for="city" class="form-label fw-bold">Ciudad</label>
              <select class="form-select" id="city" name="city" #city="ngModel" [(ngModel)]="user.citiesId" required>
                <option value="" disabled selected>Seleccione una ciudad</option>
                <option *ngFor="let c of ciudades" [ngValue]="c.id">{{ c.name }}</option>
              </select>
              <!-- Mensaje de error si no se selecciona ciudad -->
              <div *ngIf="city.invalid && city.touched" class="text-danger mt-1">
                <small>Seleccione una ciudad.</small>
              </div>
            </div>

            <!-- Botón para guardar cambios -->
            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-primary btn-lg rounded-pill" [disabled]="!profileForm.valid">
                Guardar cambios
              </button>
            </div>

          </form>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Modal de éxito al guardar cambios -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <h4 class="text-success fw-bold mb-3">¡Cambios guardados!</h4>
      <p>Tu perfil se ha actualizado correctamente.</p>
      <!-- Botón para cerrar modal y ejecutar closeModal() -->
      <button class="btn btn-success rounded-pill px-4" data-bs-dismiss="modal" (click)="closeModal()">Aceptar</button>
    </div>
  </div>
</div>

<!-- Modal de error al guardar cambios -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <h4 class="text-danger fw-bold mb-3">Error al guardar</h4>
      <!-- Muestra mensaje de error dinámico -->
      <p>{{ errorMessage }}</p>
      <button class="btn btn-danger rounded-pill px-4" data-bs-dismiss="modal">Cerrar</button>
    </div>
  </div>
</div>